# 事务

事务是数据库管理的一个核心概念，它帮助确保数据的完整性和一致性。一个事务将数据库从一种一致状态转换到另一种一致状态，确保要么所有的修改都被保存，要么一个都不保存。

## 事务概念

在MySQL中，事务处理是保证ACID属性的关键机制，这包括：

### 原子性（Atomicity）
- 事务视为不可分割的单元。所有操作要么全部成功，要么全部失败。如果事务中的任何SQL语句失败，已经执行的语句也必须撤销，数据库应恢复到事务执行前的状态。

### 一致性（Consistency）
- 事务保证数据库在开始前和结束后都保持数据一致性。如果事务失败，系统可以自动撤销事务，恢复到初始状态。

### 隔离性（Isolation）
- 事务的修改在提交之前，对其他事务是不可见的。隔离性通常通过锁来实现，防止多个事务同时操作同一数据。

### 持久性（Durability）
- 一旦事务提交，其结果是永久性的，即使发生系统故障，事务的结果也不会丢失，系统能够恢复数据。

InnoDB存储引擎支持的默认事务隔离级别是“可重复读（REPEATABLE READ）”，并且完全符合ACID属性的要求。

基于您提供的关于MySQL事务级别的PDF文件内容，我将帮您整理和转换成Markdown格式，并对语言进行优化，使得概念和解释更加清晰易懂。

---

## 事务隔离级别

事务的概念围绕着“完成整体或者不完成”的理念。在数据库操作中，事务需要满足ACID四大特性：

- **原子性（Atomicity）**：事务的操作要么全完成，要么全不完成，不留半成品。
- **一致性（Consistency）**：事务确保数据从一个一致的状态转变到另一个一致的状态。
- **隔离性（Isolation）**：事务的执行不应受其他事务的干扰。
- **持久性（Durability）**：一旦事务提交，其结果就是永久的。

## 事务引发的问题

### 脏读
发生当一个事务读取另一个事务未提交的数据。

例如，事务A转账给B但未提交，事务C读取B的账户发现钱数增加。

```sql
1. update account set money=money+100 where name='B';
2. update account set money=money-100 where name='A';
```

### 幻读
一个事务两次查询得到不同的结果集。例如，事务A查询所有账户总额时，事务B新增账户并存款，事务A再次查询发现总额变化。

### 不可重复读
一个事务在多次读取同一数据时得到不同结果。例如，事务A查询账户余额后，事务B修改了该账户余额并提交，事务A再次查询发现余额变动。

### 更新丢失
两个事务对同一数据进行读取后修改，可能导致其中一个事务的修改被另一个覆盖。

## 事务隔离级别

为解决上述问题，SQL标准定义了四个隔离级别：

### 未授权读取（Read Uncommitted）
- 最低级别，可能出现脏读、不可重复读和幻读。

### 授权读取（Read Committed）
- 避免脏读，但可能发生不可重复读和幻读。

### 可重复读取（Repeatable Read）- MySQL默认级别
- 防止脏读和不可重复读，可能发生幻读。

### 序列化（Serializable）
- 最高隔离级别，通过强制事务串行执行，避免所有上述问题。

## 解决方案

- **脏读**: 设置事务级别为`Read Committed`或更高。
- **幻读**: 采用`Repeatable Read`或`Serializable`级别。
- **不可重复读**: 使用`Repeatable Read`级别。
- **更新丢失**: 采用乐观锁或悲观锁策略。

## 补充
- 不同数据库的实现可能有差异。
- 高隔离级别可能影响数据库性能。
